<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <title>Flying Numbers Animation</title>
  <style>
    /* Styling for the game */
    html, body {
      margin: 0;
      overflow: hidden;
      touch-action: none;
      height: 100%;
    }

    body {
      margin: 0;
      overflow: hidden;
      display: flex;
      background-image: url('bg.jpeg');
      background-size: cover;
      background-position: center;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: white;
      position: relative;
    }

    .number {
      position: absolute;
      font-size: 20px;
      font-weight: bold;
      animation: fly 1s ease-out forwards;
    }

    @keyframes fly {
      0% {
        opacity: 1;
        transform: translateY(1) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-300px) scale(3.2);
      }
    }

    #scoreDisplay {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      z-index: 10;
    }

    #coinIcon {
      width: 25px;
      height: 25px;
    }

    #centerImage {
      position: absolute;
      width: 300px;
      height: 300px;
      transition: width 0.1s, height 0.1s, transform 0.5s ease-out;
    }
  </style>
</head>
<body>
  <div id="scoreDisplay">
    <img id="coinIcon" src="coinlogo.png" alt="Coin" />
    <span id="score">0</span>
  </div>

  <img id="centerImage" src="alex.png" alt="Center Image">

  <script type="module">
  // Import Firebase modules
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // Firebase configuration (same as the one from the first HTML)
  const firebaseConfig = {
    apiKey: "AIzaSyBX3g8wWxcTtwFDsJNJVcjUDIGxMd1L0Rk",
    authDomain: "mytestapp-f6913.firebaseapp.com",
    databaseURL: "https://mytestapp-f6913-default-rtdb.firebaseio.com",
    projectId: "mytestapp-f6913",
    storageBucket: "mytestapp-f6913.firebasestorage.app",
    messagingSenderId: "300150696072",
    appId: "1:300150696072:web:1e29cb5a813d004018573d",
    measurementId: "G-PPDR4TBQF5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Assuming user data is available (could be from Telegram API or other sources)
  const userData = {
    name: "John Doe", // Replace with dynamic user name
    username: "johndoe123", // Replace with dynamic username
    id: "123456789", // Replace with dynamic user ID
    isPremium: true, // Set based on user premium status (true or false)
  };

  // DOM Elements
  const scoreDisplay = document.getElementById('score');
  let score = parseInt(localStorage.getItem('score')) || 0;
  scoreDisplay.textContent = score;

  // Function to update score and send user data to Firestore
  const updateUserDataAndScore = async () => {
    try {
      // Create a Firestore document to store the user data and score
      const docRef = doc(db, "user_scores", userData.id);  // Use user ID as the document ID
      await setDoc(docRef, {
        score,
        name: userData.name,
        username: userData.username,
        id: userData.id,
        isPremium: userData.isPremium
      });
      console.log("User data and score updated in Firestore");
    } catch (error) {
      console.error("Error writing to Firestore:", error);
    }
  };

  // Update score and user data to Firebase Firestore
  function updateScore() {
    localStorage.setItem('score', score);
    scoreDisplay.textContent = score;
    updateUserDataAndScore();  // Sync with Firestore on each score update
  }

  // Create flying numbers (same as before)
  function createFlyingNumber(x, y) {
    const number = document.createElement('div');
    number.className = 'number';
    number.style.left = `${x}px`;
    number.style.top = `${y}px`;
    number.textContent = '+1';
    document.body.appendChild(number);

    number.addEventListener('animationend', () => {
      number.remove();
    });

    score += 1;
    updateScore();
  }

  // Handle user interaction (click or touch)
  document.body.addEventListener('click', (e) => {
    createFlyingNumber(e.clientX, e.clientY);
  });

  document.body.addEventListener('touchstart', (e) => {
    e.preventDefault();
    for (let i = 0; i < e.touches.length; i++) {
      const touchX = e.touches[i].clientX;
      const touchY = e.touches[i].clientY;
      createFlyingNumber(touchX, touchY);
    }
  });
</script>
